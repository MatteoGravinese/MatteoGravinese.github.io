<html>
  <head>
    <meta charset="UTF-8">
    <title>AI Blackjack Simulation</title>
    <link rel="stylesheet" href="https://pyscript.net/releases/2024.5.1/core.css" />
    <script type="module" src="https://pyscript.net/releases/2024.5.1/core.js"></script>
    <style>
      #main-container {
        display: flex;
        flex-direction: row;
        gap: 20px;
        margin-top: 20px;
      }
      #output {
        display: block;
        background-color: #1e1e1e;
        color: #ffffff;
        font-family: monospace;
        width: 600px;
        height: 300px;
        padding: 10px;
        border-radius: 6px;
        overflow-y: auto;
        white-space: pre-wrap;
        margin-top: 15px;
      }
      #plot {
        width: 600px;
        height: 300px;
        border: 1px solid #ccc;
        border-radius: 6px;
        background: #fff;
      }
    </style>
  </head>
  <body>
    <h1>AI Blackjack Simulation</h1>
    <label>Total AI Number:</label>
    <input type="number" id="total-ai" value="10"><br><br>
    <label>Hands Played:</label>
    <input type="number" id="hands-played" value="10"><br><br>
    <button py-click="run_simulation">Start Simulation</button>
    <div id="main-container">
      <div id="output"></div>
      <div id="plot"></div>
    </div>
    <py-config>
      { "packages": ["matplotlib"] }
    </py-config>
    <py-script>
async def run_simulation(*args, **kwargs):
  from js import document, setTimeout
  def scroll_to_bottom():
    term = document.querySelector("#output")
    term.scrollTop = term.scrollHeight
  TotalAINumber = int(document.querySelector("#total-ai").value)
  HandsPlayed = int(document.querySelector("#hands-played").value)
  term = document.querySelector("#output")
  term.innerHTML = ""
  import matplotlib.pyplot as plt
  import random
  import asyncio
  TotalAIMoney=[]
  RiskFactor=4
  StartingMoney=1000
  DealerHand=[]
  AIHand=[]
  DealerHandF=[0]
  HandNumber=0
  AIMoney=StartingMoney
  AmountBet=0
  TurnOver=0
  Bust=0
  DealerTurnOver=0
  AIHandSum=0
  DealerHandSum=0
  SplitCheck=0
  SplitCheck1=0
  Win=0
  AINumber=0
  AverageAIMoney=0
  Above1000Checker=0
  DealerFirstCard=[]
  FirstHandCheck=0
  EndingMoney=2000
  DoubleDownCheck=0
  BettingClosed=0



  async def BettingRules():
      nonlocal AIMoney, RiskFactor, AmountBet, HandsPlayed, HandNumber, TurnOver, BettingClosed, Win
      if 10 &lt; AIMoney &lt; EndingMoney:
          if Win==1 or HandNumber==0:
              AmountBet=AIMoney/(2**RiskFactor)
          elif Win==0 and AIMoney &gt;= AmountBet*2:
              AmountBet=AmountBet*2
          elif Win==0:
              AmountBet=AIMoney
          term.innerHTML += f"Amount bet: ${round(AmountBet, 2)}<br>"
          setTimeout(scroll_to_bottom, 0)
          term.scrollTop = term.scrollHeight
          await asyncio.sleep(0)
      else:
          AmountBet=0
          HandNumber=HandsPlayed
          BettingClosed=1
          term.innerHTML += f"AI ends with ${round(AIMoney, 2)}<br>"
          term.scrollTop = term.scrollHeight
      AIMoney=AIMoney-AmountBet


  async def JQKAIHand():
      nonlocal AIHand
      AIHand[-1]=10


  async def JQKDealerHand():
      nonlocal DealerHandF
      DealerHandF[-1]=10


  async def Split():
      nonlocal SplitCheck, AmountBet, AIHand, DealerHand, FirstHandCheck, AINumber
      SplitCheck=AIHand[1]
      AIHand[1]=random.randint(1, 13)
      term.innerHTML += f"AI splits and now has {AIHand}<br>"
      term.scrollTop = term.scrollHeight
      if AIHand[-1] &gt; 10:
          await JQKAIHand()
      if AIHand[0]==1 and AIHand[1] &gt; 9:
          await Blackjack()
      FirstHandCheck=0


  async def Hit():
      nonlocal AIHand, AIHandSum, DoubleDownCheck, AINumber
      AIHand.append(random.randint(1, 13))
      if AIHand[-1] &gt; 10:
          await JQKAIHand()
      AIHandSum=AIHandSum+AIHand[-1]
      term.innerHTML += f"AI hits and now has {AIHand}<br>"
      term.scrollTop = term.scrollHeight


  async def DoubleDown():
      nonlocal AmountBet, AIHand, TurnOver, AIMoney, FirstHandCheck, DoubleDownCheck, AINumber
      if AIMoney &gt; AmountBet:
          DoubleDownCheck=1
          AIMoney=AIMoney-AmountBet
          AmountBet=AmountBet*2
          await Hit()
          term.innerHTML += f"AI doubles down and now has {AIHand}<br>"
          term.scrollTop = term.scrollHeight
          DoubleDownCheck=0
          TurnOver=1
      else:
          await Hit()
      FirstHandCheck=1


  async def Blackjack():
      nonlocal AmountBet, AIMoney, TurnOver, BettingClosed, AINumber, AIHand, Bust, Win, FirstHandCheck
      AIMoney=AIMoney+2.5*AmountBet
      TurnOver=1
      Bust=1
      Win=1
      FirstHandCheck=1
      term.innerHTML += f"BlackJack! {AIHand}<br>"
      term.scrollTop = term.scrollHeight
      term.innerHTML += f"AI won and now has ${round(AIMoney, 2)}<br>"
      term.scrollTop = term.scrollHeight
      BettingClosed=1


  async def Stand():
      nonlocal TurnOver, AINumber
      TurnOver=1
      term.innerHTML += f"AI stands with {AIHand}<br>"
      term.scrollTop = term.scrollHeight


  async def DealerHit():
      nonlocal DealerHandF, DealerHandSum, AINumber
      DealerHandF.append(random.randint(1, 13))
      if DealerHandF[-1] &gt; 10:
          await JQKDealerHand()
      DealerHandSum=DealerHandSum+DealerHandF[-1]
      term.innerHTML += f"Dealer has {DealerHandF}<br>"
      term.scrollTop = term.scrollHeight
      
  while AINumber &lt; TotalAINumber:
      if AINumber%1000==0 and AINumber!=0:
          term.innerHTML += f"AIs played: {AINumber}<br>"
          term.scrollTop = term.scrollHeight
      AIMoney=StartingMoney
      HandNumber=0
      AmountBet=0
      SplitCheck=0
      SplitCheck1=0
      term.innerHTML += f"AI begins with ${AIMoney}<br>"
      term.scrollTop = term.scrollHeight
      while HandNumber &lt; HandsPlayed:
          TurnOver=0
          FirstHandCheck=0
          Bust=0
          BettingClosed=0
          AIHandSum=0
          DealerFirstCard=[]
          await BettingRules()
          Win=0
          AIHand=[random.randint(1, 13)]
          if AIHand[0] &gt; 10:
              AIHand[0]=10
          if SplitCheck==0:
              DealerTurnOver=0
              DealerHandF=[0]
              DealerHandSum=0
              DealerHand=[random.randint(1, 13)]
              if DealerHand[0] &gt; 10:
                  DealerHand[0]=10
              DealerHand.append(random.randint(1, 13))
              if DealerHand[1] &gt; 10:
                  DealerHand[1]=10
          if AINumber!=TotalAINumber-1:
              term.innerHTML += f"Dealer's showing card: {DealerHand[1]}<br>"
              term.scrollTop = term.scrollHeight
          AIHand.append(random.randint(1, 13))
          if AIHand[1] &gt; 10:
              AIHand[1]=10
          if SplitCheck &gt; 0:
              term.innerHTML += f"AI previously split with {SplitCheck}<br>"
              term.scrollTop = term.scrollHeight
              AIHand[0]=SplitCheck
              SplitCheck=0
          AIHand.sort()
          DealerFirstCard.append(DealerHand[0])
          DealerFirstCard.append(DealerHand[1])
          DealerHand.sort()
          if DealerHand[0]==1:
              if DealerHand[1]==10:
                  if AIHand[0]==1 and AIHand[1] &gt; 9:
                      Win=2
                      AIMoney=AIMoney+AmountBet
                      term.innerHTML += f"AI and Dealer both have BlackJack<br>"
                      term.scrollTop = term.scrollHeight
                      term.innerHTML += f"Tie, AI now has ${round(AIMoney, 2)}<br>"
                      term.scrollTop = term.scrollHeight
                  else:
                      term.innerHTML += f"Dealer has BlackJack<br>"
                      term.scrollTop = term.scrollHeight
                      term.innerHTML += f"Loss, AI now has ${round(AIMoney, 2)}<br>"
                      term.scrollTop = term.scrollHeight
                  Bust=1
                  FirstHandCheck=1
                  TurnOver=1
          if AIHand[0]==1 and AIHand[1] &gt; 9 and Bust==0:
              await Blackjack()
          if AINumber!=TotalAINumber-1:
              term.innerHTML += f"AI's original cards: {AIHand}<br>"
              term.scrollTop = term.scrollHeight
          DealerHand[0]=DealerFirstCard[0]
          DealerHand[1]=DealerFirstCard[1]
          if TurnOver==0 and BettingClosed==0:
              while FirstHandCheck==0:
                  AIHandSum=AIHand[0]+AIHand[1]
                  if AIHand[0]==AIHand[1]:
                      FirstHandCheck=1
                      if AIHand[0]==1 or AIHand[0]==8:
                          await Split()
                      elif AIHand[0]==2 or AIHand [0]==3:
                          if 3 &lt; DealerHand[1] &lt; 8:
                              await Split()
                          else:
                              await Hit()
                      elif AIHand[0]==4:
                          await Hit()
                      elif AIHand[0]==5:
                          if DealerHand[1] &lt; 10 and DealerHand[1]!=1:
                              await DoubleDown()
                          else:
                              await Hit()
                          if DealerHand[1] &lt; 7 and DealerHand[1]!=1:
                              await Split()
                          else:
                              await Hit()
                      elif AIHand[0]==7:
                          if DealerHand[1] &lt; 8 and DealerHand[1]!=1:
                              await Split()
                          else:
                              await Hit()
                      elif AIHand[0]==9:
                          if DealerHand[1] &lt; 7 and DealerHand[1]!=1:
                              await Split()
                          elif DealerHand[1]==8 or DealerHand[1]==9:
                              await Split()
                          else:
                              await Hit()
                      else:
                          await Stand()
                  elif AIHand[0]==1 and FirstHandCheck==0:
                      FirstHandCheck=1
                      if AIHand[1] &lt; 7:
                          if 3 &lt; DealerHand[1] &lt; 7:
                              await DoubleDown()
                          else:
                              await Hit()
                      elif AIHand[1]==7:
                          if DealerHand[1]==2 or DealerHand[1]==7 or DealerHand[1]==8:
                              await Stand()
                          elif 2 &lt; DealerHand[1] &lt; 7:
                              await DoubleDown()
                          else:
                              await Hit()
                      else:
                          await Stand()    
                  elif FirstHandCheck==0:
                      FirstHandCheck=1
                      if AIHand[0]+AIHand[1] &lt; 9:
                          await Hit()
                      elif AIHand[0]+AIHand[1]==9:
                          if 2 &lt; DealerHand[1] &lt; 7:
                              await DoubleDown()
                          else:
                              await Hit()
                      elif AIHand[0]+AIHand[1]==10:
                          if DealerHand[1] &lt; 10 and DealerHand[1]!=1:
                              await DoubleDown()
                          else:
                              await Hit()
                      elif AIHand[0]+AIHand[1]==11:
                          await DoubleDown()
                      elif AIHand[0]+AIHand[1]==12:
                          if 3 &lt; DealerHand[1] &lt; 7:
                              await Stand()
                          else:
                              await Hit()
                      elif AIHand[0]+AIHand[1] &lt; 17:
                          if DealerHand[1] &lt; 7 and DealerHand[1]!=1:
                              await Stand()
                          else:
                              await Hit()
                      else:
                          await Stand()
              while TurnOver==0:
                  AIHand.sort()
                  if AIHand[0]==1:
                      if AIHandSum &lt; 8:
                          await Hit()
                      elif AIHandSum==8:
                          if DealerHand[1]==2 or DealerHand[1]==7 or DealerHand[1]==8:
                              await Stand()
                          else:
                              await Hit()
                      else:
                          await Stand()    
                  else:
                      if AIHandSum &lt; 12:
                          await Hit()
                      elif AIHandSum==12:
                          if 3 &lt; DealerHand[1] &lt; 7:
                              await Stand()
                          else:
                              await Hit()
                      elif AIHandSum &lt; 17:
                          if DealerHand[1] &lt; 7 and DealerHand[1]!=1:
                              await Stand()
                          else:
                              await Hit()
                      elif AIHandSum &lt; 22:
                          await Stand()
                  if AIHandSum &gt; 21:
                      term.innerHTML += f"AI Busted with {AIHandSum}<br>"
                      term.scrollTop = term.scrollHeight
                      term.innerHTML += f"Loss, AI now has ${round(AIMoney, 2)}<br>"
                      term.scrollTop = term.scrollHeight
                      Bust=1
                      TurnOver=1
          if Bust==0 and BettingClosed==0:
              if SplitCheck1==0:
                  DealerHandF.append(DealerHand[1])
                  DealerHandF[0]=DealerHand[0]
                  DealerHandSum=DealerHandF[0]+DealerHandF[1]
                  term.innerHTML += f"Dealer has {DealerHandF}<br>"
                  term.scrollTop = term.scrollHeight
                  while DealerTurnOver==0:
                      DealerHandF.sort()
                      if DealerHandF[0]==1:
                          if DealerHandSum+10 &gt; 17 and DealerHandSum+10 &lt; 22:
                              DealerHandSum=DealerHandSum+10
                              DealerTurnOver=1
                          elif DealerHandSum &lt; 17:
                              await DealerHit()
                          else:
                              DealerTurnOver=1
                      elif DealerHandSum &lt; 17:
                          await DealerHit()
                      else:
                          DealerTurnOver=1
              else:
                  term.innerHTML += f"The AI split during the previous hand so it will play against the same dealer.<br>"
                  term.scrollTop = term.scrollHeight
              AIHand.sort()
              term.innerHTML += f"Final AI hand: {AIHand}<br>"
              term.scrollTop = term.scrollHeight
              term.innerHTML += f"Final Dealer hand: {DealerHandF}<br>"
              term.scrollTop = term.scrollHeight
              if AIHand[0]==1:
                  if AIHandSum+10 &lt; 22:
                      AIHandSum=AIHandSum+10
              if DealerHandSum &gt; 21:
                  AIMoney=AIMoney+2*AmountBet
                  Win=1
                  term.innerHTML += f"Win, AI now has ${round(AIMoney, 2)}<br>"
                  term.scrollTop = term.scrollHeight
              elif AIHandSum &gt; DealerHandSum:
                  AIMoney=AIMoney+2*AmountBet
                  Win=1
                  term.innerHTML += f"Tie, AI now has ${round(AIMoney, 2)}<br>"
                  term.scrollTop = term.scrollHeight
              elif AIHandSum==DealerHandSum:
                  Win=2
                  AIMoney=AIMoney+AmountBet
                  term.innerHTML += f"Tie, AI now has ${round(AIMoney, 2)}<br>"
                  term.scrollTop = term.scrollHeight
              else:
                  term.innerHTML += f"Loss, AI now has ${round(AIMoney, 2)}<br>"
                  term.scrollTop = term.scrollHeight
          term.innerHTML += "<br>" + "<br>"
          term.scrollTop = term.scrollHeight
          term.scrollTop = term.scrollHeight
          SplitCheck1=0
          if SplitCheck &gt; 0:
              SplitCheck1=1
          HandNumber=HandNumber+1
      if AINumber!=TotalAINumber-1:
          term.innerHTML += f"Moving on to a new AI<br>"
          term.scrollTop = term.scrollHeight
      term.innerHTML += "<br>" + "<br>"
      term.scrollTop = term.scrollHeight
      term.scrollTop = term.scrollHeight
      TotalAIMoney.append(AIMoney)
      AINumber=AINumber+1
  TotalAIMoney.sort()
  term.innerHTML += f"Total AIs trained: {TotalAINumber}<br>"
  term.scrollTop = term.scrollHeight
  for z in range(0, len(TotalAIMoney), 1):
      AverageAIMoney=AverageAIMoney+TotalAIMoney[z]
      if TotalAIMoney[z] &gt; 1000 and Above1000Checker==0:
          term.innerHTML += f"Percentage of AIs Above {EndingMoney}: {100-(100*(z-1)/TotalAINumber)}<br>"
          term.scrollTop = term.scrollHeight
          Above1000Checker=1
  AverageAIMoney=AverageAIMoney/TotalAINumber
  term.innerHTML += f"Mean: ${AverageAIMoney}<br>"
  term.scrollTop = term.scrollHeight
  TotalAIMoney.sort()
  term.innerHTML += f"Median: ${TotalAIMoney[TotalAINumber//2]}<br>"
  term.scrollTop = term.scrollHeight
  plt.hist(TotalAIMoney, 100)
  plt.title("Amount of Money Each AI Ends With")
  plt.xlabel("Final Amount of Money.")
  plt.ylabel("Frequency.")
  plt.show()
    </py-script>
  </body>
</html>
